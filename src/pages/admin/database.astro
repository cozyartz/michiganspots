---
import Layout from '../../layouts/Layout.astro';
import { DatabaseViewer } from '../../components/DatabaseViewer';
---

<Layout
  title="Database Viewer | Michigan Spots Admin"
  description="View and manage D1 database tables"
  keywords="database, admin, D1, viewer"
>
  <div id="auth-check" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
    <p>Verifying authentication...</p>
  </div>
  <div id="database-content" style="display: none;">
    <DatabaseViewer client:load />
  </div>

  <script>
    // Client-side authentication check
    async function checkAuth() {
      try {
        const response = await fetch('/api/auth/user');
        const data = await response.json();

        if (!data.user || data.user.role !== 'super_admin') {
          window.location.href = '/?error=unauthorized';
          return;
        }

        // User is authenticated as super admin
        document.getElementById('auth-check')!.style.display = 'none';
        document.getElementById('database-content')!.style.display = 'block';
      } catch (error) {
        window.location.href = '/login?redirect=/admin/database';
      }
    }

    checkAuth();
  </script>
</Layout>
