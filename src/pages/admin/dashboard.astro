---
import Layout from '../../layouts/Layout.astro';
import { SuperAdminDashboard } from '../../components/SuperAdminDashboard';
---

<Layout
  title="Super Admin Dashboard | Michigan Spots"
  description="Michigan Spots super admin dashboard - complete platform oversight and analytics"
  keywords="Michigan Spots admin, dashboard, analytics, super admin"
>
  <div id="auth-check" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
    <p>Verifying authentication...</p>
  </div>
  <div id="dashboard-content" style="display: none;">
    <SuperAdminDashboard client:load />
  </div>

  <script>
    // Client-side authentication check
    async function checkAuth() {
      try {
        const response = await fetch('/api/auth/user');
        const data = await response.json();

        if (!data.user || data.user.role !== 'super_admin') {
          window.location.href = '/?error=unauthorized';
          return;
        }

        // User is authenticated as super admin
        document.getElementById('auth-check')!.style.display = 'none';
        document.getElementById('dashboard-content')!.style.display = 'block';
      } catch (error) {
        window.location.href = '/login?redirect=/admin/dashboard';
      }
    }

    checkAuth();
  </script>
</Layout>
